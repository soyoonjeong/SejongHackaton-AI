**인터넷**은 end system에서 수행되는 분산 애플리케이션에게 서비스를 제공해주는 **인프라 구조**이다.

이상적으로는 인터넷 서비스가 데이터 손실 없이 즉시 두 종단 시스템 간에 원하는 만큼의 데이터를 이동시키기를 원한다.

하지만 현실에서는 어려우며 컴퓨터 네트워크는 두 종단 시스템 간에 전달 될 수 있는 초당 데이터의양 —> 처리율을 제한한다.

따라서 이로이해 end system 사이에는 지연이 발생하며 패킷을 잃어버리기도 한다.

### 1. 패킷 교환 네트워크에서의 지연

패킷은 출발지 → 라우터들 → 도착지 과정을 거친다.

패킷이 이런 경로를 따라 한 노드에서 다음 노드로 전달될 때 패킷은 경로상의 **각 노드에서 다양한 지연**을 겪게 되며 이들은 쌓여서 **전체 노드 지연**을 일으킨다.

- 노드 처리 지연 (nodal processing delay)
- 큐잉 지연 (queueing delay)
- 전송 지연 ( transmission delay )
- 전파 지연 ( propagation delay )


이 그림은 라우터 A에서 노드 지연을 나타낸 것이다.

출발지와 목적지 사이 종단 간 경로의 일부로서, 한 패킷이 업스트림 노드로부터 라우터 A를 통해 라우터 B로 보내진다.

- 업스트림 : 클라이언트에서 서버로 전송되는 데이터의 흐름
- 다운 스트림 : 서버에서 클라이언트로 전송되는 데이터의 흐름, 일반적으로 다운스트림  트래픽은 업스트림 트래픽보다 더 많은 볼륨이 있다.

라우터 A는 라우터 B에 이르는 `하나의 출력(outgoing) 링크`를 가지며, 이 링크 앞에 `큐(queue, 버퍼(buffer))`가 존재한다.

1. 패킷이 업스트림 노드로부터 라우터 A에 도착한다.
2. 라우터 A는 그 패킷에 대한 적당한 출력 링크를 결정하기 위해 패킷 헤더를 조사한다.
3. 라우터 A는 선택된 링크로 그 패킷을 보낸다. (그림에서 선택된 링크 = 라우터 B에 이르는 링크)

**Processing Delay ( 처리 지연 )**

패킷 헤더를 조사하고 그 패킷을 어떤 IP로 보낼지 결정하는 시간

- 라우터 A로 패킷의 비트를 전송할 때 업스트림 노드에서 발생하는 패킷의 비트 레벨 오류를 조사하는 데 필요한 시간도 이 처리 지연에 해당한다.
- 라우터는 이 노트 처리 후, 그 패킷을 라우터 B에 이르는 링크에 앞선 큐에 보낸다.

**Queuing delay ( 큐잉 지연 )  —> 해커톤 때 겪은 것**

패킷이 큐에서 링크로 전송되기를 기다리는 시간

- 특정 패킷의 큐잉 지연 길이는 큐에 저장되어 링크로 전송되기를 기다리는, **앞서 도착한 다른 패킷의 수에 의해 결정된다.**
- 주어진 패킷의 지연은 패킷마다 상당히 다르다.
    - 큐가 비어있고 다른 패킷이 전송 중인 상태가 아니라면 패킷의 큐잉 지연 → 0
    - 트래픽이 많고 다른 많은 패킷이 전송 대기 중이라면 패킷의 큐잉 지연 → 매우 길어진다.

**Transmission Delay ( 전송 지연)**

패킷의 모든 비트를 링크로 밀어내는 데 ( 전송하는데) 필요한 시간

패킷이 FIFO 방식으로 전송된다고 가정할 때 패킷의 길이는 L비트 라우터 A에서 B까지의 링크 전송률을 R bps라고 할 때 전송 지연은 L / R 이다.

**Propagation delay (전파 지연)**

비트가 라우터 A 상에서의 링크에서 라우터 B까지의 전파에 필요한 시간

- 비트는 링크의 전파 속도로 전파된다.
- 전파 속도는 링크의 물리 매체(광섬유, 꼬임쌍선 등)에 따라 다르며, 범위는 2×(10^8)미터/초 ~ 3×(10^8)미터/초이다.→ 빛의 속도와 같거나 약간 작다.

라우터 A와 B 사이의 거리를 `d`, 링크의 전파 속도를 `s`라고 한다면 전파 지연은 `d/s`이다.

**전송지연 vs 전파지연**

- 전송 지연 : 라우터가 패킷을 내보내는데 걸리는 시간 —> 패킷의 길이와 링크 전송률 함수 ( 두 라우터 사이의 거리는 상관 없음 )
- 전파 지연 : 한 라우터에서 다음 라우터로 전파되는 데 걸리는 시간 —> 두 라우터 사이의 거리 ( 패킷의 길이와 링크 전송률과는 상관없음)

**Total Nodal Delay ( 전체 노드 지연 )**

모든 지연을 더한 것 = 처리 지연 + 큐잉 지연 + 전파 지연 + 전송 지연

- 전파 지연
    - 내부의 두 라우터를 연결하는 링크 == 2마이크로초 (무시가능)
    - 정지 위성링크로 연결된 두 라우터의 경우 수백 밀리초 → 전체 노드 지연의 주요 요소
- 전송 지연
    - LAN처럼 10Mbps 이상의 전송률의 경우 → 무시가능
    - 저속 다이얼업 모뎀 링크에서 보내지는 인터넷 패킷은 수백 밀리초에 이를 수 있다.

- 처리 지연
    - 보통 전체 노드 지연에서 무시됨
    - 라우터가 패킷을 전달할 수 있는 최대 속도에는 상당한 영향을 준다.

